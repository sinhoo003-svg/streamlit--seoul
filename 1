import streamlit as st
import pandas as pd 
import numpy as np 
from datetime import datetime, timedelta 

# --- 1. ë°ì´í„° ì„¤ì • ë° ìƒì„± ---
# ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ê¸°ë³¸ ë³€ìˆ˜ ì„¤ì •
N_DAYS = 60
end_date = datetime.today().date()
dates = pd.date_range(end=end_date, periods=N_DAYS, freq='D')

# ë¶„ì„ ëŒ€ìƒ í•­ëª© ë¦¬ìŠ¤íŠ¸ ì„¤ì •
all_users = ["Sinu", "Soyoon", "Gayeon"]

# ë¬´ì‘ìœ„ ì‹œê³„ì—´ ë°ì´í„° ìƒì„±
user_data_series = {
    user: (np.random.randn(N_DAYS) * 5).cumsum() + 100 
    for user in all_users
}
# data_full: 60ì¼ ì „ì²´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì›ë³¸ ë°ì´í„°í”„ë ˆì„ì…ë‹ˆë‹¤.
data_full = pd.DataFrame(user_data_series, index=dates)

st.title("ğŸ“ˆ Streamlit ë°ì´í„° ëŒ€ì‹œë³´ë“œ")
st.write('Streamlit supports a wide range of data visualizations, including [Plotly, Altair, and Bokeh charts].')


# --- 2. ëŒ€í™”í˜• ìœ„ì ¯ (ì‚¬ìš©ì ì…ë ¥) ---
with st.container(border=True):
    col1, col2, col3 = st.columns([1.5, 1, 1])

    with col1:
        # 1. ì‚¬ìš©ì ì„ íƒ
        users = st.multiselect("Users (ë¶„ì„ ëŒ€ìƒ)", all_users, default=all_users)
    
    with col2:
        # 2. ë¡¤ë§ í‰ê·  í† ê¸€
        rolling_average = st.toggle("Rolling average (í‰í™œí™”)")

    with col3:
        # 3. [ìƒˆ ê¸°ëŠ¥] ì°¨íŠ¸ ìœ í˜• ì„ íƒ ë¼ë””ì˜¤ ë²„íŠ¼
        chart_type = st.radio(
            "ì°¨íŠ¸ ìœ í˜• ì„ íƒ", 
            ("ì„  ê·¸ë˜í”„", "ì˜ì—­ ê·¸ë˜í”„", "ë§‰ëŒ€ ê·¸ë˜í”„"), 
            horizontal=True
        )

# ì„ íƒëœ ì‚¬ìš©ìë§Œ í¬í•¨í•˜ëŠ” ë°ì´í„° í•„í„°ë§
data = data_full[users]


# --- 3. ë°ì´í„° ì²˜ë¦¬ ë…¼ë¦¬ ---
# í† ê¸€ ìŠ¤ìœ„ì¹˜ì— ë°˜ì‘í•˜ëŠ” ì¡°ê±´ë¶€ ë…¼ë¦¬
if rolling_average:
    data = data.rolling(7).mean().dropna()

# ë°ì´í„°ê°€ ë¹„ì–´ìˆì„ ê²½ìš° ì²˜ë¦¬
if data.empty:
    st.info("ì„ íƒëœ ì‚¬ìš©ìê°€ ì—†ê±°ë‚˜, ë¡¤ë§ í‰ê·  ì ìš© í›„ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")
    st.stop()


# --- 4. ë ˆì´ì•„ì›ƒ ë° ì‹œê°í™” ---
st.subheader(f"ê²°ê³¼ ì‹œê°í™”: {chart_type}")
tab1, tab2 = st.tabs(["ğŸ“‰ ì¶”ì„¸ ì°¨íŠ¸", "ğŸ“‹ ë°ì´í„° í…Œì´ë¸”"])

with tab1:
    # ì°¨íŠ¸ ìœ í˜•ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ê·¸ë˜í”„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    if chart_type == "ì„  ê·¸ë˜í”„":
        st.line_chart(data, height=400)
    elif chart_type == "ì˜ì—­ ê·¸ë˜í”„":
        st.area_chart(data, height=400)
    elif chart_type == "ë§‰ëŒ€ ê·¸ë˜í”„":
        st.bar_chart(data, height=400)
    
with tab2:
    # ë°ì´í„°í”„ë ˆì„ í…Œì´ë¸”ì„ í‘œì‹œí•©ë‹ˆë‹¤.
    st.dataframe(data, height=400, use_container_width=True)
